!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vubx={})}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("[vubx warn] "+e)}function n(t,e){function n(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function r(t){j(t,x,{value:new $,enumerable:!1})}function i(t,e,n){var r=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return o(this,r,t,e)},n}function o(t,e,n,r){var i=t.__scope__.$root.__scope__,o=t.__scope__,s=$.get(t),c=r||C,u={type:String(s.identifier)+": "+c,payload:n,mutationType:c,identifier:s.identifier},a=i.globalMiddlewate,p=o.middleware,f=o.isCommitting;o.isCommitting=!0,a.dispatchBefore(t,u,t),p.dispatchBefore(t,u,t);var l=e.apply(t,n);return p.dispatchAfter(t,u,t),a.dispatchAfter(t,u,t),o.isCommitting=f,l}function s(t){return new B(t)}function c(t,e){var n=t.__scope__.$state;Object.keys(t).forEach(function(r){e.indexOf(r)<0&&j(n,r,M({get:function(){return t[r]}},K))}),j(t,"$state",{value:n,enumerable:!1})}function u(t,e,n){var r=t.__scope__.$getters;n.forEach(function(e){j(r,e,M({get:function(){return t[e]},set:function(n){return t[e]=n}},K))}),j(t,"$getters",{value:r,enumerable:!1,configurable:!1})}function a(t,e){e.forEach(function(e){j(t,e,{get:function(){return this.__scope__.$vm[e]},enumerable:!1,configurable:!0})})}function p(t){for(var e={},n=t;n!==D.prototype&&n!==Object.prototype&&null!==n;)e=M({},f(n),e),n=Object.getPrototypeOf(n);return e}function f(t){var e={},n=H.get(t).injectMeta;return Object.getOwnPropertyNames(t).forEach(function(r){if("constructor"!==r&&!n.has(r)){var i=Object.getOwnPropertyDescriptor(t,r);i&&i.get&&(e[r]={get:i.get,set:i.set&&i.set})}}),e}function l(t){var n=$.get(t).identifier;"production"!==process.env.NODE_ENV&&t.__scope__.$vm&&t.__scope__.$vm.$watch(function(){return t.$state},function(r){e(t.__scope__.isCommitting,"Do not mutate vubx service["+String(n)+"] data outside mutation handlers.")},{deep:!0,sync:!0})}function h(t){var e=$.get(t).provider,n="undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;if(n){var r=_(e);r._devtoolHook=n,n.emit("vuex:init",r),n.on("vuex:travel-to-state",function(t){e.replaceAllState(t)}),t.__scope__.globalMiddlewate.subscribe({after:function(t,e){n.emit("vuex:mutation",t,e)}})}}function _(t){var e=d(t.proxy);return{state:e.state,getters:e.getters,_devtoolHook:null}}function d(t){var e={},n={},r=Object.keys(t);return Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t))),r.forEach(function(r){var i=t[r];i instanceof D&&(j(e,String(r),{value:i.__scope__.$getters,enumerable:!0,configurable:!0}),j(n,String(r),{value:i.__scope__.$state,enumerable:!0,configurable:!0}))}),{state:n,getters:e}}function g(t){return function(e){return function(n){return v(t,n,e)}}}function v(t,r,i){var o=H.setGetterMeta(r.prototype);return a(r.prototype,o.getterKeys),function(o){function s(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var a=o.apply(this,n)||this,p=H.get(r.prototype),f=new t({data:a,computed:m(p.getterMeta,p.getterKeys,a)}),l=M({identifier:"__vubx__",root:!1,devtool:!1,providers:[],plugins:[],globalPlugins:[],createdHook:H.get(r.prototype).hookMeta},i),_=new G(a,l);if(j(a,"__scope__",{value:_,enumerable:!1}),_.$vm=f,c(a,p.getterKeys),u(a,f,p.getterKeys),i&&i.root){e(i.identifier,"A root Service must has a identifier and please check your decorator option"),_.$root=a;var d=new V;d.registerInjectedHook(function(t,e){t instanceof D&&(t.__scope__.$root=a,y(t,t.__scope__.vubxOption,e))}),d.register(new E(l.identifier,!0,a)),l.providers.forEach(function(t){return d.register(t.injectorFactory())});var g=$.get(a);g.identifier=l.identifier,g.provider=d,y(a,l,g),g.hasBeenInjected=!0,l.devtool&&h(a)}return a}return n(s,o),s}(r)}function y(t,e,n){b(t,t.__scope__.globalPlugins.concat(e.plugins));var r=t.__scope__.$root.__scope__.vubxOption;(e.hasOwnProperty("strict")?e.strict:r.strict)&&l(t);var i=e.createdHook;if(i){var o=n.provider.getAll(i.deps);i.method.apply(t,o)}}function b(t,e){e.forEach(function(e){return e(t)})}function m(t,e,n){var r={};return e.forEach(function(e){r[e]={get:t[e].get.bind(n)}}),r}function S(t,e){return"object"==typeof t&&e?w(t,e):function(e,n){return w(e,n,t)}}function w(t,e,n){var r=n||e;return H.get(t).injectMeta.set(e,{identifier:n}),{get:function(){var t=$.get(this).provider.get(r);return j(this,e,{value:t,enumerable:!1,configurable:!0}),t},enumerable:!1,configuriable:!0}}function O(t){return void 0===t&&(t=[]),function(e,n,r){H.get(e).hookMeta={method:r.value,methodName:n,deps:t}}}var j=Object.defineProperty,P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},M=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},x="__meta__",$=function(){function t(){this.hasBeenInjected=!1}return t.get=function(t){return t[x]||r(t),t[x]},t}(),I=function(){function t(){this.isSingleton=!0}return t.prototype.addDIMeta=function(t,e){var n=$.get(t);n.hasBeenInjected||(n.identifier=e,n.provider=this.provider,this.provider.hooks.forEach(function(e){return e(t,n)}),n.hasBeenInjected=!0)},t}(),k=function(t){function e(e,n,r){var i=t.call(this)||this;return i.identifier=e,i.isSingleton=n,i.serviceClass=r,i}return n(e,t),e.prototype.resolve=function(){return this.isSingleton?(this.instance||(this.instance=this.getInstance()),this.instance):this.getInstance()},e.prototype.getInstance=function(){var t=new this.serviceClass;return this.addDIMeta(t,this.identifier),t},e}(I),E=function(t){function r(e,n,r){var i=t.call(this)||this;return i.identifier=e,i.isSingleton=n,i.service=r,i}return n(r,t),r.prototype.resolve=function(){return this.instance||(this.instance=this.getInstance()),this.instance},r.prototype.getInstance=function(){return this.addDIMeta(this.service,this.identifier),this.service},r.prototype.inTransientScope=function(){return e(!1,"Value injector not support inTransientScope"),this},r}(I),A=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.identifier=e,o.isSingleton=n,o.ServiceFactory=r,o.deps=i,o}return n(e,t),e.prototype.resolve=function(){return this.isSingleton?(this.instance||(this.instance=this.getInstance()),this.instance):this.getInstance()},e.prototype.getInstance=function(){var t=this.provider.getAll(this.deps),e=this.ServiceFactory.apply(null,t);return this.addDIMeta(e,this.identifier),e},e}(I),C="<unnamed mutation>",D=function(){function t(){}return t.prototype.mutation=function(t,e){return o(this,t,null,e)},t.prototype.replaceState=function(e,n){void 0===n&&(n=!1);var r=this.__scope__.isCommitting;this.__scope__.isCommitting=!0;for(var i in e)this[i]instanceof t?n&&this[i].replaceState(e[i]):this.hasOwnProperty(i)&&(this[i]=e[i]);this.__scope__.isCommitting=r},t.prototype.replaceAllState=function(t){$.get(this).provider.replaceAllState(t)},t.prototype.injectService=function(t,e,n){var r=$.get(this).provider;r.checkIdentifier(n),r.register(new E(n,!0,t)),j(this,e,{value:t,enumerable:!1,configurable:!0})},t.prototype.subscribe=function(t){this.__scope__.middleware.subscribe(t)},t.prototype.subscribeGlobal=function(t){e(this.__scope__.$root===this,"Only root service has subscribeGlobal methods"),this.__scope__.globalMiddlewate.subscribe(t)},t.prototype.getProvide=function(){return $.get(this).provider.proxy},t}(),B=function(){function t(t){this.isSingleton=!0,this.identifier=t}return t.prototype.toClass=function(t){var e=this;return this.injectorFactory=function(){return new k(e.identifier,e.isSingleton,t)},this},t.prototype.toValue=function(t){var e=this;return this.injectorFactory=function(){return new E(e.identifier,e.isSingleton,t)},this},t.prototype.toFactory=function(t,e){var n=this;return void 0===e&&(e=[]),this.injectorFactory=function(){return new A(n.identifier,n.isSingleton,t,e)},this},t.prototype.inSingletonScope=function(){return this.isSingleton=!0,this},t.prototype.inTransientScope=function(){return this.isSingleton=!1,this},t}(),T=function(){function t(){this.dictionary={}}return t.prototype.get=function(t){return this.dictionary[t]||void 0},t.prototype.set=function(t,e){return this.dictionary[t]=e,this},t.prototype.has=function(t){return this.dictionary.hasOwnProperty(t)},t}(),N="function"==typeof Map?Map:T,V=function(){function t(){this.injectorMap=new N,this.proxy={},this.hooks=[]}return t.prototype.get=function(t){var n=this.injectorMap.get(t);return"production"!==process.env.NODE_ENV&&e(n,String(t)+" not find in provider"),n.resolve()},t.prototype.getAll=function(t){var e=this;return t.map(function(t){return e.get(t)})},t.prototype.register=function(t){this.checkIdentifier(t.identifier),t.provider=this,this.injectorMap.set(t.identifier,t),this.defProxy(t)},t.prototype.checkIdentifier=function(t){"production"!==process.env.NODE_ENV&&e(!this.injectorMap.has(t),"The identifier "+String(t)+" has been repeated")},t.prototype.replaceAllState=function(t){for(var e in t){var n=this.proxy[e];n instanceof D&&n.replaceState(t[e],!1)}},t.prototype.registerInjectedHook=function(t){this.hooks.indexOf(t)>-1||this.hooks.push(t)},t.prototype.defProxy=function(t){var e={get:function(){return t.resolve()},enumerable:!0,configurable:!0};j(this.proxy,t.identifier,e),"symbol"==typeof t.identifier&&j(this.proxy,String(t.identifier),e)},t}(),F=function(){function t(){this.beforeSubs=[],this.afterSubs=[]}return t.prototype.subscribe=function(t){t&&(t.before&&this.beforeSubs.push(t.before),t.after&&this.afterSubs.push(t.after))},t.prototype.createTask=function(t,e){void 0===e&&(e=null);var n=this;return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];n.dispatchBefore.apply(n,[e].concat(r));var o=t.apply(e,r);return n.dispatchAfter.apply(n,[e].concat(r)),o}},t.prototype.dispatchBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.beforeSubs,t].concat(e))},t.prototype.dispatchAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.afterSubs,t].concat(e))},t.prototype.run=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var i=0,o=t;i<o.length&&!1!==o[i].apply(e,n);i++);},t}(),H=function(){function t(){this.injectMeta=new N}return t.get=function(e){return e.constructor.__meta__||(e.constructor.__meta__=new t)},t.setGetterMeta=function(e){var n=t.get(e);return n.getterMeta=p(e),n.getterKeys=Object.keys(n.getterMeta),n},t}(),K={enumerable:!0,configurable:!0},G=function(){function t(t,n){this.$getters={},this.$state={},this.isCommitting=!1,this.middleware=new F,this.isRoot=!!n.root,this.isRoot?(this._root=t,this._globalMiddllewate=new F,this._globalPlugins=n.globalPlugins||[]):n.globalPlugins.length>0&&e(!1,"The globalPlugins option only to be used in root service"),this.vubxOption=n}return Object.defineProperty(t.prototype,"$root",{get:function(){return e(this._root,"There must be a root Service and please check your decorator option , or confirm your class has extends Service class"),this._root},set:function(t){this._root=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalPlugins",{get:function(){return this.$root.__scope__._globalPlugins},set:function(t){this.$root.__scope__._globalPlugins=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalMiddlewate",{get:function(){return this.$root.__scope__._globalMiddllewate},enumerable:!0,configurable:!0}),t}();t.Service=D,t.bind=s,t.createDecorator=g,t.mutation=i,t.lazyInject=S,t.created=O,Object.defineProperty(t,"__esModule",{value:!0})});
