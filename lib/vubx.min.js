!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vubx={})}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("[vubx warn] "+e)}function n(t,e){function n(){this.constructor=t}O(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function i(t){w(t,P,{value:new x,enumerable:!1})}function r(t,e,n){var i=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return o(this,i,t,e)},n}function o(t,e,n,i){var r=t.__scope__.$root.__scope__,o=t.__scope__,s=x.get(t),c=i||E,u={type:String(s.identifier)+": "+c,payload:n,mutationType:c,identifier:s.identifier},a=r.globalMiddlewate,p=o.middleware,f=o.isCommitting;o.isCommitting=!0,a.dispatchBefore(t,u,t),p.dispatchBefore(t,u,t);var l=e.apply(t,n);return p.dispatchAfter(t,u,t),a.dispatchAfter(t,u,t),o.isCommitting=f,l}function s(t){return new C(t)}function c(t,e){var n=t.__scope__.$state;Object.keys(t).forEach(function(i){e.indexOf(i)<0&&w(n,i,j({get:function(){return t[i]}},F))}),w(t,"$state",{value:n,enumerable:!1})}function u(t,e,n){var i=t.__scope__.$getters;n.forEach(function(n){w(t,n,{get:function(){return e[n]},set:function(t){return e[n]=t},enumerable:!1,configurable:!0}),w(i,n,j({get:function(){return t[n]},set:function(e){return t[n]=e}},F))}),w(t,"$getters",{value:i,enumerable:!1,configurable:!1})}function a(t,e){for(var n={},i=t;i!==A.prototype&&i!==Object.prototype&&null!==i;)n=j({},p(i,e),n),i=Object.getPrototypeOf(i);return n}function p(t,e){var n={},i=V.get(t).propertyMeta;return Object.getOwnPropertyNames(t).forEach(function(r){if("constructor"!==r&&!i.has(r)){var o=Object.getOwnPropertyDescriptor(t,r);o&&o.get&&(n[r]={get:o.get.bind(e),set:o.set&&o.set.bind(e)})}}),n}function f(t){var n=x.get(t).identifier;"production"!==process.env.NODE_ENV&&t.__scope__.$vm&&t.__scope__.$vm.$watch(function(){return t.$state},function(i){e(t.__scope__.isCommitting,"Do not mutate vubx service["+String(n)+"] data outside mutation handlers.")},{deep:!0,sync:!0})}function l(t){var e=x.get(t).provider,n="undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;if(n){var i=h(e);i._devtoolHook=n,n.emit("vuex:init",i),n.on("vuex:travel-to-state",function(t){e.replaceAllState(t)}),t.__scope__.globalMiddlewate.subscribe({after:function(t,e){n.emit("vuex:mutation",t,e)}})}}function h(t){var e=d(t.proxy);return{state:e.state,getters:e.getters,_devtoolHook:null}}function d(t){var e={},n={},i=Object.keys(t);return Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t))),i.forEach(function(i){var r=t[i];r instanceof A&&(w(e,String(i),{value:r.__scope__.$getters,enumerable:!0,configurable:!0}),w(n,String(i),{value:r.__scope__.$state,enumerable:!0,configurable:!0}))}),{state:n,getters:e}}function _(t){return function(e){return function(n){return g(t,n,e)}}}function g(t,i,r){return function(o){function s(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var p=o.apply(this,n)||this,f=a(i.prototype,p),h=Object.keys(f),d=new t({data:p,computed:f}),_=j({identifier:"__vubx__",root:!1,devtool:!1,providers:[],plugins:[],globalPlugins:[],createdHook:V.get(i.prototype).hookMeta},r),g=new H(p,_);if(w(p,"__scope__",{value:g,enumerable:!1}),g.$vm=d,c(p,h),u(p,d,h),r&&r.root){e(r.identifier,"A root Service must has a identifier and please check your decorator option"),g.$root=p;var y=new T;y.registerInjectedHook(function(t,e){t instanceof A&&(t.__scope__.$root=p,v(t,t.__scope__.vubxOption,e))}),y.register(new $(_.identifier,!0,p)),_.providers.forEach(function(t){return y.register(t.injectorFactory())});var b=x.get(p);b.identifier=_.identifier,b.provider=y,v(p,_,b),b.hasBeenInjected=!0,_.devtool&&l(p)}return p}return n(s,o),s}(i)}function v(t,e,n){y(t,t.__scope__.globalPlugins.concat(e.plugins));var i=t.__scope__.$root.__scope__.vubxOption;(e.hasOwnProperty("strict")?e.strict:i.strict)&&f(t);var r=e.createdHook;if(r){var o=n.provider.getAll(r.deps);r.method.apply(t,o)}}function y(t,e){e.forEach(function(e){return e(t)})}function b(t,e){return"object"==typeof t&&e?m(t,e):function(e,n){return m(e,n,t)}}function m(t,e,n){var i=n||e;return V.get(t).propertyMeta.set(e,{identifier:n}),{get:function(){var t=x.get(this).provider.get(i);return w(this,e,{value:t,enumerable:!1,configurable:!0}),t},enumerable:!1,configuriable:!0}}function S(t){return void 0===t&&(t=[]),function(e,n,i){V.get(e).hookMeta={method:i.value,methodName:n,deps:t}}}var w=Object.defineProperty,O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},j=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},P="__meta__",x=function(){function t(){this.hasBeenInjected=!1}return t.get=function(t){return t[P]||i(t),t[P]},t}(),M=function(){function t(){this.isSingleton=!0}return t.prototype.addDIMeta=function(t,e){var n=x.get(t);n.hasBeenInjected||(n.identifier=e,n.provider=this.provider,this.provider.hooks.forEach(function(e){return e(t,n)}),n.hasBeenInjected=!0)},t}(),I=function(t){function e(e,n,i){var r=t.call(this)||this;return r.identifier=e,r.isSingleton=n,r.serviceClass=i,r}return n(e,t),e.prototype.resolve=function(){return this.isSingleton?(this.instance||(this.instance=this.getInstance()),this.instance):this.getInstance()},e.prototype.getInstance=function(){var t=new this.serviceClass;return this.addDIMeta(t,this.identifier),t},e}(M),$=function(t){function i(e,n,i){var r=t.call(this)||this;return r.identifier=e,r.isSingleton=n,r.service=i,r}return n(i,t),i.prototype.resolve=function(){return this.instance||(this.instance=this.getInstance()),this.instance},i.prototype.getInstance=function(){return this.addDIMeta(this.service,this.identifier),this.service},i.prototype.inTransientScope=function(){return e(!1,"Value injector not support inTransientScope"),this},i}(M),k=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.identifier=e,o.isSingleton=n,o.ServiceFactory=i,o.deps=r,o}return n(e,t),e.prototype.resolve=function(){return this.isSingleton?(this.instance||(this.instance=this.getInstance()),this.instance):this.getInstance()},e.prototype.getInstance=function(){var t=this.provider.getAll(this.deps),e=this.ServiceFactory.apply(null,t);return this.addDIMeta(e,this.identifier),e},e}(M),E="<unnamed mutation>",A=function(){function t(){}return t.prototype.mutation=function(t,e){return o(this,t,null,e)},t.prototype.replaceState=function(e,n){void 0===n&&(n=!1);var i=this.__scope__.isCommitting;this.__scope__.isCommitting=!0;for(var r in e)this[r]instanceof t?n&&this[r].replaceState(e[r]):this.hasOwnProperty(r)&&(this[r]=e[r]);this.__scope__.isCommitting=i},t.prototype.replaceAllState=function(t){x.get(this).provider.replaceAllState(t)},t.prototype.injectService=function(t,e,n){var i=x.get(this).provider;i.checkIdentifier(n),i.register(new $(n,!0,t)),w(this,e,{value:t,enumerable:!1,configurable:!0})},t.prototype.subscribe=function(t){this.__scope__.middleware.subscribe(t)},t.prototype.subscribeGlobal=function(t){e(this.__scope__.$root===this,"Only root service has subscribeGlobal methods"),this.__scope__.globalMiddlewate.subscribe(t)},t.prototype.getProvide=function(){return x.get(this).provider.proxy},t}(),C=function(){function t(t){this.isSingleton=!0,this.identifier=t}return t.prototype.toClass=function(t){var e=this;return this.injectorFactory=function(){return new I(e.identifier,e.isSingleton,t)},this},t.prototype.toValue=function(t){var e=this;return this.injectorFactory=function(){return new $(e.identifier,e.isSingleton,t)},this},t.prototype.toFactory=function(t,e){var n=this;return void 0===e&&(e=[]),this.injectorFactory=function(){return new k(n.identifier,n.isSingleton,t,e)},this},t.prototype.inSingletonScope=function(){return this.isSingleton=!0,this},t.prototype.inTransientScope=function(){return this.isSingleton=!1,this},t}(),D=function(){function t(){this.dictionary={}}return t.prototype.get=function(t){return this.dictionary[t]||void 0},t.prototype.set=function(t,e){return this.dictionary[t]=e,this},t.prototype.has=function(t){return void 0!==this.dictionary[t]},t}(),B="function"==typeof Map?Map:D,T=function(){function t(){this.injectorMap=new B,this.proxy={},this.hooks=[]}return t.prototype.get=function(t){var n=this.injectorMap.get(t);return"production"!==process.env.NODE_ENV&&e(n,String(t)+" not find in provider"),n.resolve()},t.prototype.getAll=function(t){var e=this;return t.map(function(t){return e.get(t)})},t.prototype.register=function(t){this.checkIdentifier(t.identifier),t.provider=this,this.injectorMap.set(t.identifier,t),this.defProxy(t)},t.prototype.checkIdentifier=function(t){"production"!==process.env.NODE_ENV&&e(!this.injectorMap.has(t),"The identifier "+String(t)+" has been repeated")},t.prototype.replaceAllState=function(t){for(var e in t){var n=this.proxy[e];n instanceof A&&n.replaceState(t[e],!1)}},t.prototype.registerInjectedHook=function(t){this.hooks.indexOf(t)>-1||this.hooks.push(t)},t.prototype.defProxy=function(t){var e={get:function(){return t.resolve()},enumerable:!0,configurable:!0};w(this.proxy,t.identifier,e),"symbol"==typeof t.identifier&&w(this.proxy,String(t.identifier),e)},t}(),N=function(){function t(){this.beforeSubs=[],this.afterSubs=[]}return t.prototype.subscribe=function(t){t&&(t.before&&this.beforeSubs.push(t.before),t.after&&this.afterSubs.push(t.after))},t.prototype.createTask=function(t,e){void 0===e&&(e=null);var n=this;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];n.dispatchBefore.apply(n,[e].concat(i));var o=t.apply(e,i);return n.dispatchAfter.apply(n,[e].concat(i)),o}},t.prototype.dispatchBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.beforeSubs,t].concat(e))},t.prototype.dispatchAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.afterSubs,t].concat(e))},t.prototype.run=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var r=0,o=t;r<o.length&&!1!==o[r].apply(e,n);r++);},t}(),V=function(){function t(t){this.target=t,this.propertyMeta=new Map}return t.get=function(e){return e.constructor.__meta__||(e.constructor.__meta__=new t(e))},t}(),F={enumerable:!0,configurable:!0},H=function(){function t(t,n){this.$getters={},this.$state={},this.isCommitting=!1,this.middleware=new N,this.isRoot=!!n.root,this.isRoot?(this._root=t,this._globalMiddllewate=new N,this._globalPlugins=n.globalPlugins||[]):n.globalPlugins.length>0&&e(!1,"The globalPlugins option only to be used in root service"),this.vubxOption=n}return Object.defineProperty(t.prototype,"$root",{get:function(){return e(this._root,"There must be a root Service and please check your decorator option , or confirm your class has extends Service class"),this._root},set:function(t){this._root=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalPlugins",{get:function(){return this.$root.__scope__._globalPlugins},set:function(t){this.$root.__scope__._globalPlugins=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalMiddlewate",{get:function(){return this.$root.__scope__._globalMiddllewate},enumerable:!0,configurable:!0}),t}();t.Service=A,t.bind=s,t.createDecorator=_,t.mutation=r,t.lazyInject=b,t.created=S,Object.defineProperty(t,"__esModule",{value:!0})});
