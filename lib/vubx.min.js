!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vubx={})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t,e){if(!t)throw new Error("[vubx warn] "+e)}function r(t,e){return function(n){n.getProvider().register(t,e)}}function o(t,e){return function(n){n.getProvider().push(t,e())}}function i(t){return function(e,n,r){var o,i=function(){if(o)return o;var e=this.$service.getProvider();return o=e.getInstance(t),d(this.$service,n,o,t),o};return r?(r.get=i,r):{get:i,set:function(){},enumerable:!0,configurable:!0}}}function s(t){var e="undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;if(e){var n=c(t);n._devtoolHook=e,e.emit("vuex:init",n),e.on("vuex:travel-to-state",function(e){t.replaceState(e)}),t.__.middleware.subscribe({after:function(t,n){e.emit("vuex:mutation",t,n)}})}}function c(t){return{state:t.__.$state,getters:t.__.$getters,_devtoolHook:null}}function a(t){return function(n){return function(r){return function(o){function i(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=o.apply(this,e)||this;y(s,"__",{enumerable:!1});var c=_(r.prototype),a=r.prototype.created,d=Object.keys(c),l=new t({data:s,computed:c});f(s,d),p(s,l,d),h(s,l);var v=s.__;if(v.$vm=l,l.$service=s,n){var g=n.root,b=n.identifier,$=n.provider,O=void 0===$?[]:$,w=n.injector,M=void 0===w?[]:w,P=n.plugins,E=void 0===P?[]:P;g&&(v.$root=s,v.provider=new m,b&&(v.identifier=b,v.provider.push(b,s))),u(s,O.concat(M).concat(E))}return a&&a.call(s),s}return e(i,o),i}(r)}}}function u(t,e){e.forEach(function(e){return e(t)})}function f(t,e){var n=t.__.$state;Object.keys(t).forEach(function(r){e.indexOf(r)<0&&y(n,r,g({get:function(){return t[r]}},$))})}function p(t,e,n){var r=t.__.$getters;n.forEach(function(n){y(t,n,g({get:function(){return e[n]},set:function(t){return e[n]=t}},$)),y(r,n,g({get:function(){return t[n]},set:function(e){return t[n]=e}},$))})}function h(t,e){for(var n=0,r=w;n<r.length;n++)!function(n){y(t,n,{get:function(){return e[n].bind(e)},enumerable:!1})}(r[n])}function _(t){var e={};return Object.getOwnPropertyNames(t).forEach(function(n){if("constructor"!==n){var r=Object.getOwnPropertyDescriptor(t,n);r.get&&(e[n]={get:r.get,set:r.set})}}),e}function d(t,e,r,o){t.__.$children.push(r),r.__.$parent.indexOf(t)<=-1&&r.__.$parent.push(t),"production"!==process.env.NODE_ENV&&n(t.__.$root,"Make sure to have a root service, Please check the root options in the decorator configuration"),r.__.$root=t.__.$root,r.__.identifier=o,y(t.__.$state,e,g({get:function(){return r.__.$state}},$)),y(t.__.$getters,e,g({get:function(){return r.__.$getters}},$))}function l(t,e,n){var r=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=this.__.middleware,i={type:this.__.identifier.toString()+": "+e,payload:t},s=this.__.$root||this,c=s.__.isCommitting;s.__.isCommitting=!0;var a;try{o.dispatchBefore(this,i,this),a=r.apply(this,t),o.dispatchAfter(this,i,this)}finally{s.__.isCommitting=c}return a},n}var v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},y=Object.defineProperty,b=function(){function t(){this.beforeSubs=[],this.afterSubs=[]}return t.prototype.subscribe=function(t){t&&(t.before&&this.beforeSubs.push(t.before),t.after&&this.afterSubs.push(t.after))},t.prototype.createTask=function(t,e){void 0===e&&(e=null);var n=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n.dispatchBefore.apply(n,[e].concat(r));var i=t.apply(e,r);return n.dispatchAfter.apply(n,[e].concat(r)),i}},t.prototype.dispatchBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.beforeSubs,t].concat(e))},t.prototype.dispatchAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.afterSubs,t].concat(e))},t.prototype.run=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var o=0,i=t;o<i.length&&!1!==i[o].apply(e,n);o++);},t}(),m=function(){function t(){this.instancesMap=new Map,this.classMap=new Map,this.injectorMap=new Map,this.proxy={}}return Object.defineProperty(t.prototype,"instances",{get:function(){return Array.from(this.instancesMap)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classes",{get:function(){return Array.from(this.classMap)},enumerable:!0,configurable:!0}),t.prototype.register=function(t,e){this.checkIdentifier(t),this.classMap.set(t,e),this.defProxy(t)},t.prototype.push=function(t,e){this.checkIdentifier(t),this.instancesMap.set(t,e),this.defProxy(t)},t.prototype.defProxy=function(t){var e=this;y(this.proxy,t,{get:function(){return e.getInstance(t)},enumerable:!0,configurable:!0})},t.prototype.getInstance=function(t){if(!this.instancesMap.has(t)){var e=this.classMap.get(t);"production"!==process.env.NODE_ENV&&n(e,t.toString()+" can not find this class"),e&&this.instancesMap.set(t,new e)}return this.instancesMap.get(t)},t.prototype.removeInstance=function(t){"production"!==process.env.NODE_ENV&&n(this.instancesMap.has(t),"Can not find this instance : identifier["+t.toString()+"]"),this.instancesMap.delete(t)},t.prototype.checkIdentifier=function(t){"production"!==process.env.NODE_ENV&&n(!this.classMap.has(t)&&!this.instancesMap.has(t),"The identifier "+t.toString()+" has been repeated")},t.prototype.hasInstance=function(t){return this.instancesMap.has(t)},t.prototype.hasClass=function(t){return this.classMap.has(t)},t}(),$={enumerable:!0,configurable:!0},O=function(){function t(){this.__={$vm:null,$getters:{},$state:{},$root:null,$parent:[],$children:[],isCommitting:!1,middleware:new b,provider:null,identifier:"__vubx__"}}return t.prototype.replaceState=function(e){var n=this.__.isCommitting;this.__.isCommitting=!0;for(var r in e)this[r]instanceof t?this[r].replaceState(e[r]):this[r]=e[r];this.__.isCommitting=n},t.prototype.appendChild=function(t,e,n){this.getProvider().checkIdentifier(n),y(this,e,{enumerable:!0,get:function(){return t}}),d(this,e,t,n),this.__.$root&&this.__.$root.getProvider().push(n,t)},t.prototype.getProvider=function(){return"production"!==process.env.NODE_ENV&&n(this.__.$root,"Make sure to have a root service, Please check the root options in the decorator configuration"),this.__.$root.__.provider},t.prototype.subscribe=function(t){this.__.middleware.subscribe(t)},t.prototype.useStrict=function(t){var e=this;return void 0===t&&(t=!0),t&&"production"!==process.env.NODE_ENV&&this.__.$vm&&this.__.$vm.$watch(function(){return this.$data},function(t){n(e.__.isCommitting,"Do not mutate vubx service data outside mutation handlers.")},{deep:!0,sync:!0}),this},t.prototype.useDevtool=function(t){return void 0===t&&(t=!0),t&&s(this),this},t}(),w=["$watch","$on","$once","$emit","$off","$set","$delete","$destroy"];t.Service=O,t.bindClass=r,t.bindFactory=o,t.createDecorator=a,t.mutation=l,t.lazyInject=i,Object.defineProperty(t,"__esModule",{value:!0})});
