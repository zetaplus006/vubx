!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vubx={})}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("[vubx warn] "+e)}function n(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function i(t){S(t,j,{value:new P,enumerable:!1})}function r(t){return new E(t)}function o(t,e){var n=t.__scope__.$state;Object.keys(t).forEach(function(i){e.indexOf(i)<0&&S(n,i,O({get:function(){return t[i]}},T))}),S(t,"$state",{value:n,enumerable:!1})}function s(t,e,n){var i=t.__scope__.$getters;n.forEach(function(n){S(t,n,{get:function(){return e[n]},set:function(t){return e[n]=t},enumerable:!1,configurable:!0}),S(i,n,O({get:function(){return t[n]},set:function(e){return t[n]=e}},T))}),S(t,"$getters",{value:i,enumerable:!1,configurable:!1})}function c(t,e){for(var n={},i=t;i!==k.prototype&&i!==Object.prototype&&null!==i;)n=O({},u(i,e),n),i=Object.getPrototypeOf(i);return n}function u(t,e){var n={},i=N.get(t).propertyMeta;return Object.getOwnPropertyNames(t).forEach(function(r){if("constructor"!==r&&!i.has(r)){var o=Object.getOwnPropertyDescriptor(t,r);o&&o.get&&(n[r]={get:o.get.bind(e),set:o.set&&o.set.bind(e)})}}),n}function a(t){var n=P.get(t).identifier;"production"!==process.env.NODE_ENV&&t.__scope__.$vm&&t.__scope__.$vm.$watch(function(){return t.$state},function(i){e(t.__scope__.isCommitting,"Do not mutate vubx service["+String(n)+"] data outside mutation handlers.")},{deep:!0,sync:!0})}function p(t){var e=P.get(t).provider,n="undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;if(n){var i=f(e);i._devtoolHook=n,n.emit("vuex:init",i),n.on("vuex:travel-to-state",function(t){e.replaceAllState(t)}),t.__scope__.globalMiddlewate.subscribe({after:function(t,e){n.emit("vuex:mutation",t,e)}})}}function f(t){var e=h(t.proxy);return{state:e.state,getters:e.getters,_devtoolHook:null}}function h(t){var e={},n={},i=Object.keys(t);return Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t))),i.forEach(function(i){var r=t[i];r instanceof k&&(S(e,String(i),{value:r.__scope__.$getters,enumerable:!0,configurable:!0}),S(n,String(i),{value:r.__scope__.$state,enumerable:!0,configurable:!0}))}),{state:n,getters:e}}function l(t){return function(e){return function(n){return d(t,n,e)}}}function d(t,i,r){return function(u){function a(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var f=u.apply(this,n)||this,h=c(i.prototype,f),l=Object.keys(h),d=new t({data:f,computed:h}),g=O({identifier:"__vubx__",root:!1,devtool:!1,providers:[],plugins:[],globalPlugins:[],createdHook:N.get(i.prototype).hookMeta},r),v=new V(f,g);if(S(f,"__scope__",{value:v,enumerable:!1}),v.$vm=d,o(f,l),s(f,d,l),r&&r.root){e(r.identifier,"A root Service must has a identifier and please check your decorator option"),v.$root=f;var y=new D;y.registerInjectedHook(function(t,e){t instanceof k&&(t.__scope__.$root=f,_(t,t.__scope__.vubxOption,e))}),y.register(new I(g.identifier,!0,f)),g.providers.forEach(function(t){return y.register(t.injectorFactory())});var b=P.get(f);b.identifier=g.identifier,b.provider=y,_(f,g,b),b.hasBeenInjected=!0,g.devtool&&p(f)}return f}return n(a,u),a}(i)}function _(t,e,n){g(t,t.__scope__.globalPlugins.concat(e.plugins));var i=t.__scope__.$root.__scope__.vubxOption;(e.hasOwnProperty("strict")?e.strict:i.strict)&&a(t);var r=e.createdHook;if(r){var o=n.provider.getAll(r.deps);r.method.apply(t,o)}}function g(t,e){e.forEach(function(e){return e(t)})}function v(t,e){return"object"==typeof t&&e?y(t,e):function(e,n){return y(e,n,t)}}function y(t,e,n){var i=n||e;return N.get(t).propertyMeta.set(e,{identifier:n}),{get:function(){var t=P.get(this).provider.get(i);return S(this,e,{value:t,enumerable:!1,configurable:!0}),t},enumerable:!1,configuriable:!0}}function b(t,e,n){var i=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this.__scope__.$root.__scope__,o=this.__scope__,s=P.get(this),c={type:String(s.identifier)+": "+e,payload:t,methodName:e,identifier:s.identifier},u=r.globalMiddlewate,a=o.middleware,p=o.isCommitting;o.isCommitting=!0,u.dispatchBefore(this,c,this),a.dispatchBefore(this,c,this);var f=i.apply(this,t);return a.dispatchAfter(this,c,this),u.dispatchAfter(this,c,this),o.isCommitting=p,f},n}function m(t){return void 0===t&&(t=[]),function(e,n,i){N.get(e).hookMeta={method:i.value,methodName:n,deps:t}}}var S=Object.defineProperty,w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},O=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},j="__meta__",P=function(){function t(){this.hasBeenInjected=!1}return t.get=function(t){return t[j]||i(t),t[j]},t}(),x=function(){function t(){this.isSingleton=!0}return t.prototype.addDIMeta=function(t,e){var n=P.get(t);n.hasBeenInjected||(n.identifier=e,n.provider=this.provider,this.provider.hooks.forEach(function(e){return e(t,n)}),n.hasBeenInjected=!0)},t}(),M=function(t){function e(e,n,i){var r=t.call(this)||this;return r.identifier=e,r.isSingleton=n,r.serviceClass=i,r}return n(e,t),e.prototype.resolve=function(){return this.isSingleton?(this.instance||(this.instance=this.getInstance()),this.instance):this.getInstance()},e.prototype.getInstance=function(){var t=new this.serviceClass;return this.addDIMeta(t,this.identifier),t},e}(x),I=function(t){function i(e,n,i){var r=t.call(this)||this;return r.identifier=e,r.isSingleton=n,r.service=i,r}return n(i,t),i.prototype.resolve=function(){return this.instance||(this.instance=this.getInstance()),this.instance},i.prototype.getInstance=function(){return this.addDIMeta(this.service,this.identifier),this.service},i.prototype.inTransientScope=function(){return e(!1,"Value injector not support inTransientScope"),this},i}(x),$=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.identifier=e,o.isSingleton=n,o.ServiceFactory=i,o.deps=r,o}return n(e,t),e.prototype.resolve=function(){return this.isSingleton?(this.instance||(this.instance=this.getInstance()),this.instance):this.getInstance()},e.prototype.getInstance=function(){var t=this.provider.getAll(this.deps),e=this.ServiceFactory.apply(null,t);return this.addDIMeta(e,this.identifier),e},e}(x),k=function(){function t(){}return t.prototype.replaceState=function(e,n){void 0===n&&(n=!1);var i=this.__scope__.isCommitting;this.__scope__.isCommitting=!0;for(var r in e)this[r]instanceof t?n&&this[r].replaceState(e[r]):this.hasOwnProperty(r)&&(this[r]=e[r]);this.__scope__.isCommitting=i},t.prototype.replaceAllState=function(t){P.get(this).provider.replaceAllState(t)},t.prototype.injectService=function(t,e,n){var i=P.get(this).provider;i.checkIdentifier(n),i.register(new I(n,!0,t)),S(this,e,{value:t,enumerable:!1,configurable:!0})},t.prototype.subscribe=function(t){this.__scope__.middleware.subscribe(t)},t.prototype.subscribeGlobal=function(t){e(this.__scope__.$root===this,"Only root service has subscribeGlobal methods"),this.__scope__.globalMiddlewate.subscribe(t)},t.prototype.getProvide=function(){return P.get(this).provider.proxy},t}(),E=function(){function t(t){this.isSingleton=!0,this.identifier=t}return t.prototype.toClass=function(t){var e=this;return this.injectorFactory=function(){return new M(e.identifier,e.isSingleton,t)},this},t.prototype.toValue=function(t){var e=this;return this.injectorFactory=function(){return new I(e.identifier,e.isSingleton,t)},this},t.prototype.toFactory=function(t,e){var n=this;return void 0===e&&(e=[]),this.injectorFactory=function(){return new $(n.identifier,n.isSingleton,t,e)},this},t.prototype.inSingletonScope=function(){return this.isSingleton=!0,this},t.prototype.inTransientScope=function(){return this.isSingleton=!1,this},t}(),A=function(){function t(){this.dictionary={}}return t.prototype.get=function(t){return this.dictionary[t]||void 0},t.prototype.set=function(t,e){return this.dictionary[t]=e,this},t.prototype.has=function(t){return void 0!==this.dictionary[t]},t}(),C="function"==typeof Map?Map:A,D=function(){function t(){this.injectorMap=new C,this.proxy={},this.hooks=[]}return t.prototype.get=function(t){var n=this.injectorMap.get(t);return"production"!==process.env.NODE_ENV&&e(n,String(t)+" not find in provider"),n.resolve()},t.prototype.getAll=function(t){var e=this;return t.map(function(t){return e.get(t)})},t.prototype.register=function(t){this.checkIdentifier(t.identifier),t.provider=this,this.injectorMap.set(t.identifier,t),this.defProxy(t)},t.prototype.checkIdentifier=function(t){"production"!==process.env.NODE_ENV&&e(!this.injectorMap.has(t),"The identifier "+String(t)+" has been repeated")},t.prototype.replaceAllState=function(t){for(var e in t){var n=this.proxy[e];n instanceof k&&n.replaceState(t[e],!1)}},t.prototype.registerInjectedHook=function(t){this.hooks.indexOf(t)>-1||this.hooks.push(t)},t.prototype.defProxy=function(t){var e={get:function(){return t.resolve()},enumerable:!0,configurable:!0};S(this.proxy,t.identifier,e),"symbol"==typeof t.identifier&&S(this.proxy,String(t.identifier),e)},t}(),B=function(){function t(){this.beforeSubs=[],this.afterSubs=[]}return t.prototype.subscribe=function(t){t&&(t.before&&this.beforeSubs.push(t.before),t.after&&this.afterSubs.push(t.after))},t.prototype.createTask=function(t,e){void 0===e&&(e=null);var n=this;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];n.dispatchBefore.apply(n,[e].concat(i));var o=t.apply(e,i);return n.dispatchAfter.apply(n,[e].concat(i)),o}},t.prototype.dispatchBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.beforeSubs,t].concat(e))},t.prototype.dispatchAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.afterSubs,t].concat(e))},t.prototype.run=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var r=0,o=t;r<o.length&&!1!==o[r].apply(e,n);r++);},t}(),N=function(){function t(t){this.target=t,this.propertyMeta=new Map}return t.get=function(e){return e.constructor.__meta__||(e.constructor.__meta__=new t(e))},t}(),T={enumerable:!0,configurable:!0},V=function(){function t(t,n){this.$getters={},this.$state={},this.isCommitting=!1,this.middleware=new B,this.isRoot=!!n.root,this.isRoot?(this._root=t,this._globalMiddllewate=new B,this._globalPlugins=n.globalPlugins||[]):n.globalPlugins.length>0&&e(!1,"The globalPlugins option only to be used in root service"),this.vubxOption=n}return Object.defineProperty(t.prototype,"$root",{get:function(){return e(this._root,"There must be a root Service and please check your decorator option , or confirm your class has extends Service class"),this._root},set:function(t){this._root=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalPlugins",{get:function(){return this.$root.__scope__._globalPlugins},set:function(t){this.$root.__scope__._globalPlugins=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalMiddlewate",{get:function(){return this.$root.__scope__._globalMiddllewate},enumerable:!0,configurable:!0}),t}();t.Service=k,t.bind=r,t.createDecorator=l,t.mutation=b,t.lazyInject=v,t.created=m,Object.defineProperty(t,"__esModule",{value:!0})});
