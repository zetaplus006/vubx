!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vubx={})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}c((r=r.apply(t,e||[])).next())})}function r(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(t){n=[6,t],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function o(t,e){if(!t)throw new Error("[vubx warn] "+e)}function i(t,e){return function(n){n.getProvider().register(t,e)}}function s(t,e){return function(n){n.getProvider().push(t,e())}}function a(t){return function(e,n,r){var o,i=function(){if(o)return o;var e=this.$service.getProvider();return o=e.getInstance(t),v(this.$service,n,o,t),o};return r?(r.get=i,r):{get:i,set:function(){},enumerable:!0,configurable:!0}}}function c(t){var e="undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;if(e){var n=u(t);n._devtoolHook=e,e.emit("vuex:init",n),e.on("vuex:travel-to-state",function(e){t.replaceState(e)}),t.__.middleware.subscribe({after:function(t,n){e.emit("vuex:mutation",t,n)}})}}function u(t){return{state:t.__.$state,getters:t.__.$getters,_devtoolHook:null}}function f(t){return function(n){return function(r){return function(o){function i(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=o.apply(this,e)||this;b(s,"__",{enumerable:!1});var a=_(r.prototype),c=r.prototype.created,u=Object.keys(a),f=new t({data:s,computed:a});h(s,u),l(s,f,u),d(s,f);var v=s.__;if(v.$vm=f,f.$service=s,n){var y=n.root,g=n.identifier,m=n.provider,w=void 0===m?[]:m,O=n.injector,x=void 0===O?[]:O,P=n.plugins,M=void 0===P?[]:P;y&&(v.$root=s,v.provider=new $,g&&(v.identifier=g,v.provider.push(g,s))),p(s,w.concat(x).concat(M))}return c&&c.call(s),s}return e(i,o),i}(r)}}}function p(t,e){e.forEach(function(e){return e(t)})}function h(t,e){var n=t.__.$state;Object.keys(t).forEach(function(r){e.indexOf(r)<0&&b(n,r,{get:function(){return t[r]},enumerable:!0})})}function l(t,e,n){var r=t.__.$getters;n.forEach(function(n){b(t,n,{get:function(){return e[n]},set:function(t){return e[n]=t},enumerable:!0}),b(r,n,{get:function(){return t[n]},set:function(e){return t[n]=e},enumerable:!0})})}function d(t,e){for(var n=0,r=O;n<r.length;n++)!function(n){b(t,n,{get:function(){return e[n].bind(e)},enumerable:!1})}(r[n])}function _(t){var e={};return Object.getOwnPropertyNames(t).forEach(function(n){if("constructor"!==n){var r=Object.getOwnPropertyDescriptor(t,n);r.get&&(e[n]={get:r.get,set:r.set})}}),e}function v(t,e,n,r){t.__.$children.push(n),n.__.$parent.indexOf(t)<=-1&&n.__.$parent.push(t),"production"!==process.env.NODE_ENV&&o(t.__.$root,"Make sure to have a root service, Please check the root options in the decorator configuration"),n.__.$root=t.__.$root,n.__.identifier=r,t.__.$getters[e]=n.__.$getters,t.__.$state[e]=n.__.$state}function y(t,e,n){var r=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=this.__.middleware,i={type:this.__.identifier.toString()+": "+e,payload:t},s=this.__.$root||this,a=s.__.isCommitting;s.__.isCommitting=!0;var c;try{o.dispatchBefore(this,i,this),c=r.apply(this,t),o.dispatchAfter(this,i,this)}finally{s.__.isCommitting=a}return c},n}var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},b=Object.defineProperty,m=function(){function t(){this.beforeSubs=[],this.afterSubs=[]}return t.prototype.subscribe=function(t){t&&(t.before&&this.beforeSubs.push(t.before),t.after&&this.afterSubs.push(t.after))},t.prototype.createTask=function(t,e){void 0===e&&(e=null);var n=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n.dispatchBefore.apply(n,[e].concat(r));var i=t.apply(e,r);return n.dispatchAfter.apply(n,[e].concat(r)),i}},t.prototype.dispatchBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.beforeSubs,t].concat(e))},t.prototype.dispatchAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.run.apply(this,[this.afterSubs,t].concat(e))},t.prototype.run=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var o=0,i=t;o<i.length&&!1!==i[o].apply(e,n);o++);},t}(),$=function(){function t(){this.instancesMap=new Map,this.classMap=new Map,this.proxy={}}return Object.defineProperty(t.prototype,"instances",{get:function(){return Array.from(this.instancesMap)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classes",{get:function(){return Array.from(this.classMap)},enumerable:!0,configurable:!0}),t.prototype.register=function(t,e){this.checkIdentifier(t),this.classMap.set(t,e),this.defProxy(t)},t.prototype.push=function(t,e){this.checkIdentifier(t),this.instancesMap.set(t,e),this.defProxy(t)},t.prototype.defProxy=function(t){var e=this;b(this.proxy,t,{get:function(){return e.getInstance(t)},enumerable:!0,configurable:!0})},t.prototype.getInstance=function(t){if(!this.instancesMap.has(t)){var e=this.classMap.get(t);"production"!==process.env.NODE_ENV&&o(e,t.toString()+" can not find this class"),e&&this.instancesMap.set(t,new e)}return this.instancesMap.get(t)},t.prototype.removeInstance=function(t){"production"!==process.env.NODE_ENV&&o(this.instancesMap.has(t),"Can not find this instance : identifier["+t.toString()+"]"),this.instancesMap.delete(t)},t.prototype.checkIdentifier=function(t){"production"!==process.env.NODE_ENV&&o(!this.classMap.has(t)&&!this.instancesMap.has(t),"The identifier "+t.toString()+" has been repeated")},t.prototype.hasInstance=function(t){return this.instancesMap.has(t)},t.prototype.hasClass=function(t){return this.classMap.has(t)},t}(),w=function(){function t(){this.__={$vm:null,$getters:{},$state:{},$root:null,$parent:[],$children:[],isCommitting:!1,middleware:new m,provider:null,identifier:"__vubx__"}}return t.prototype.dispatch=function(t,e){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,(n=this.getProvider().getInstance(t))[e].apply(n,o)];case 1:return[2,r.sent()]}})})},t.prototype.commit=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return(o=this.getProvider().getInstance(t))[e].apply(o,n);var o},t.prototype.replaceState=function(e){var n=this.__.isCommitting;this.__.isCommitting=!0;for(var r in e)this[r]instanceof t?this[r].replaceState(e[r]):this[r]=e[r];this.__.isCommitting=n},t.prototype.appendChild=function(t,e,n){this.getProvider().checkIdentifier(n),b(this,e,{enumerable:!0,get:function(){return t}}),v(this,e,t,n),this.__.$root&&this.__.$root.getProvider().push(n,t)},t.prototype.getProvider=function(){return"production"!==process.env.NODE_ENV&&o(this.__.$root,"Make sure to have a root service, Please check the root options in the decorator configuration"),this.__.$root.__.provider},t.prototype.subscribe=function(t){this.__.middleware.subscribe(t)},t.prototype.useStrict=function(t){var e=this;return void 0===t&&(t=!0),t&&"production"!==process.env.NODE_ENV&&this.__.$vm&&this.__.$vm.$watch(function(){return this.$data},function(t){o(e.__.isCommitting,"Do not mutate vubx service data outside mutation handlers.")},{deep:!0,sync:!0}),this},t.prototype.useDevtool=function(t){return void 0===t&&(t=!0),t&&c(this),this},t}(),O=["$watch","$on","$once","$emit","$off","$set","$delete","$destroy"];t.Service=w,t.bindClass=i,t.bindFactory=s,t.createDecorator=f,t.mutation=y,t.lazyInject=a,Object.defineProperty(t,"__esModule",{value:!0})});
